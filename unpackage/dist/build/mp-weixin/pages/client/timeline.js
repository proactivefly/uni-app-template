(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/client/timeline"],{"190c":function(e,t,r){},3326:function(e,t,r){"use strict";r.r(t);var o=r("9ebd"),n=r("7e6f");for(var s in n)"default"!==s&&function(e){r.d(t,e,(function(){return n[e]}))}(s);r("d504");var a,i=r("f0c5"),l=Object(i["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=l.exports},"7e6f":function(e,t,r){"use strict";r.r(t);var o=r("879c"),n=r.n(o);for(var s in o)"default"!==s&&function(e){r.d(t,e,(function(){return o[e]}))}(s);t["default"]=n.a},"879c":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r("ee25"),n=function(){r.e("components/evaluate/rate").then(function(){return resolve(r("79c3"))}.bind(null,r)).catch(r.oe)},s={data:function(){return{idx:0,currentStep:null,totalStep:void 0,rateDialog:!1,affixBtnDisabled:!0,affixList:[],startTime:"2020-05-20",endTime:(0,o.formatTime)((new Date).getTime(),!0),userId:"",orderInfo:{orderList:[]},rate:!1,orderFlag:!0,date:"",progressList:[],controlParams:{orderId:"",code:"",nodeDate:"",attFileUrls:""},lookImg:!1,currentImgUrl:null,currentOrderId:null,rateList:[{name:"4S店满意度",value:0},{name:"员工满意度",value:0},{name:"员工专业度",value:0}],canRate:!1,orderStatus:"",currentOrderInfo:{}}},methods:{changeSlide:function(e,t){this.idx=t,this.affixList=[],this.startTime="2020-05-20",this.currentOrderId=e.orderId,this.rateList=[{name:"4S店满意度",value:0},{name:"员工满意度",value:0},{name:"员工专业度",value:0}],this.getOrderProgress(e.orderId),this.currentOrderInfo=e},dataChange:function(e,t){t.nodeDate=e.detail.value,this.controlParams.nodeDate=(0,o.dateToms)(t.nodeDate),this.controlParams.code=t.code,this.controlProgress(t)},startChange:function(e,t){t.value=e.value},uploadAffix:function(t){var r=this;e.showModal({title:"提示",content:"上传后不支持修改，是否确认上传?",success:function(e){if(e.confirm){for(var o=[],n=0;n<r.affixList.length;n++)o.push(r.affixList[n].openUrl);var s=String(o);r.controlParams.code=t.code,r.controlParams.attFileUrls=s,r.controlProgress(t)}}})},makeScore:function(t){for(var r=this,o=0;o<this.rateList.length;o++)if(!this.rateList[o].value)return void e.showToast({title:"请对".concat(this.rateList[o].name,"进行评价"),icon:"none"});var n={orderId:this.currentOrderId,score1:this.rateList[0].value,score2:this.rateList[1].value,score3:this.rateList[2].value};this.request("/order/member/evaluate",n).then((function(t){0==t.resultCode?(r.currentStep++,r.rateDialog=!1):e.showToast({title:t.resultMsg?t.resultMsg:"网络异常,请稍后重试",icon:"none"})}))},deleteFile:function(t){var r=this;this.request("/common/deleteFile",{fileId:t.fileId}).then((function(o){if(0==o.resultCode){for(var n=r.affixList,s=0;s<n.length;s++)if(t.fileId==n[s].fileId){r.affixList.splice(s,1);break}r.affixList.length<=0&&(r.affixBtnDisabled=!0)}else e.showToast({title:o.resultMsg?o.resultMsg:"网络异常,请稍后重试",icon:"none"})}))},takePicture:function(){var t=this;e.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(r){for(var n=r.tempFilePaths,s=0;s<n.length;s++)(function(r){e.showLoading(),e.uploadFile({url:getApp().globalData.requestUrl+"/common/upload",filePath:n[r],name:"upFile",header:{"content-type":"multipart/form-data","service-code":"QDMS",ticket:JSON.parse(e.getStorageSync("token")).value},success:function(e){var r=JSON.parse(e.data),n=r.data;t.affixList.push({openUrl:(0,o.http2Https)(n.openUrl),fileId:n.fileId}),t.affixBtnDisabled=!1},complete:function(t){e.hideLoading()}})})(s)}})},lookAffix:function(t){if("VOG-AL00"==this.mobileModel)this.currentImgUrl=t.openUrl,this.lookImg=!0;else{var r=[];this.affixList.forEach((function(e){r.push(e.openUrl)})),e.showLoading(),e.previewImage({current:t.openUrl,urls:r,longPressActions:{itemList:["发送给朋友","保存图片","收藏"]},fail:function(e){this.currentImgUrl=t.openUrl,this.lookImg=!0},complete:function(){e.hideLoading()}})}},getOrders:function(){var t=this;this.request("/order/member/orders",{memberId:this.userId}).then((function(r){0==r.resultCode?(t.orderInfo=r.data,t.orderInfo.orderList.length>0&&(t.getOrderProgress(t.orderInfo.orderList[0].orderId),t.currentOrderId=t.orderInfo.orderList[0].orderId,t.currentOrderInfo=t.orderInfo.orderList[0])):e.showToast({title:r.resultMsg?r.resultMsg:"网络异常,请稍后重试",icon:"none"})}))},getOrderProgress:function(t){var r=this;this.request("/order/progress/show",{orderId:t}).then((function(n){if(r.controlParams.orderId=t,0==n.resultCode){var s=1;r.progressList=n.data,r.totalStep=r.progressList.length+1,r.progressList.forEach((function(e,t){if(e.step=t+1,-1!=e.nodeDate&&(e.nodeDate=(0,o.formatTime)(e.nodeDate,!0),r.startTime=e.nodeDate,s++),e.attFileUrls)for(var n=e.attFileUrls.split(","),a=0;a<n.length;a++)r.affixList.push({openUrl:n[a],fileId:a})})),r.currentStep=s,r.currentStep>=r.totalStep&&r.getScore(r.currentOrderId)}else e.showToast({title:n.resultMsg?n.resultMsg:"网络异常,请稍后重试",icon:"none"})}))},controlProgress:function(t){var r=this;this.request("/order/progress/treat",this.controlParams).then((function(n){0==n.resultCode?(t.name="已"+t.name,t.step<6?(t.nodeDate=(0,o.formatTime)(r.controlParams.nodeDate,!0),r.startTime=(0,o.formatTime)(r.controlParams.nodeDate,!0)):t.nodeDate=(0,o.formatTime)(n.data,!0),r.currentStep++,r.currentStep>=7&&-1!=r.currentOrderInfo.orderState&&(r.rateDialog=!0)):e.showToast({title:n.resultMsg?n.resultMsg:"网络异常,请稍后重试",icon:"none"})}))},getScore:function(t){var r=this;this.request("/order/evaluate/list",{orderId:this.currentOrderId}).then((function(t){var o=t.data;0==t.resultCode?o.length>0?(r.rateList[0].value=o[0].score,r.rateList[1].value=o[1].score,r.rateList[2].value=o[2].score,r.currentStep++):-1!=r.currentOrderInfo.orderState&&(console.log("？？？"),r.rateDialog=!0):e.showToast({title:t.resultMsg?t.resultMsg:"网络异常,请稍后重试",icon:"none"})}))}},onLoad:function(e){this.userId=e.userId,this.getOrders()},components:{Evaluate:n},onShareAppMessage:function(){return{title:"卫蓝购",path:"/pages/infomation/index",imageUrl:"/static/share.png"}}};t.default=s}).call(this,r("543d")["default"])},"9ebd":function(e,t,r){"use strict";var o,n=function(){var e=this,t=e.$createElement,o=(e._self._c,e.__map(e.progressList,(function(t,o){var n=r("499a");return{$orig:e.__get_orig(t),m0:n}})));e._isMounted||(e.e0=function(t){e.lookImg=!1}),e.$mp.data=Object.assign({},{$root:{l0:o}})},s=[];r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"a",(function(){return o}))},c3ef:function(e,t,r){"use strict";(function(e){r("f318");o(r("66fd"));var t=o(r("3326"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},d504:function(e,t,r){"use strict";var o=r("190c"),n=r.n(o);n.a}},[["c3ef","common/runtime","common/vendor"]]]);