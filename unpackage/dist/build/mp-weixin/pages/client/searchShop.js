(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/client/searchShop"],{"281f":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n("fba6"),i=s(n("4872")),a=n("ee25");function s(t){return t&&t.__esModule?t:{default:t}}var c={data:function(){return{map:null,name:"",center:[],selectShopInfo:{address:null,city:null,createTime:null,deleteFlag:null,gaodeCitycode:null,id:null,lat:null,lon:null,province:null,shortName:null,tel:null},markers:[],selectCityInfo:{centralPoint:null,code:null,name:null},currentPosition:{},searchShopParams:{name:"",city:"",pageNum:1,pageSize:1e3,queryType:1},shopList:[],distance:"- -",defaultScale:16}},computed:{myPosition:function(){return this.$store.state.addrInfo}},methods:{markertap:function(t){var e=t.detail.markerId;this.selectShopInfo=this.shopList[e],this.markers.forEach((function(t){t.width=52,t.height=54})),this.markers[e].width=82,this.markers[e].height=84,this.markers[e].zIndex=2},openMap:function(){t.openLocation({latitude:parseFloat(this.selectShopInfo.lat),longitude:parseFloat(this.selectShopInfo.lon),name:this.selectShopInfo.name,address:this.selectShopInfo.address,success:function(t){console.log(t)}})},goSelect4Shop:function(){var t=null;t=this.selectCityInfo.code?this.selectCityInfo.code:this.currentPosition.cityCode?this.currentPosition.cityCode:"",this.perfectNavigateTo({url:"/pages/fourShop/fourShop?fromPage=2&cityCode="+t})},openSet:function(){var e=this;t.openSetting({success:function(t){t.authSetting["scope.userLocation"]&&e.getLocation()}})},getDistance:function(){var e=this.selectShopInfo.lon,n=this.selectShopInfo.lat;2==this.myPosition.lonlat.length&&e&&n?this.distance=(0,a.Tdistance)(this.myPosition.lonlat,[e,n]):t.showToast({title:"距离获取失败",icon:"none"})},getShopPiCity:function(){var e=this;this.request("/store/list",this.searchShopParams).then((function(n){var o=n.data;if(0==n.resultCode){var i=[];o.list.forEach((function(t,e){t.lon&&t.lat&&i.push(t)})),e.shopList=i,e.setShopListToMarker();var s=[];if(e.myPosition.lonlat.length>=2){e.shopList.forEach((function(t,n){var o=(0,a.Tdistance)(e.myPosition.lonlat,[t.lon,t.lat]);s.push(o)}));var c=Math.min.apply(Math,s),r=s.indexOf(c);r>=0&&(e.selectShopInfo=e.shopList[r],e.distance=c,e.markers.forEach((function(t){t.width=52,t.height=54})),e.markers[r].width=82,e.markers[r].height=84,e.markers[r].zIndex=2)}}else t.showToast({title:n.resultMsg?n.resultMsg:"网络异常,请稍后重试",icon:"none"})}))},selectCity:function(){this.perfectNavigateTo({url:"/pages/client/citySelect"})},setShopListToMarker:function(){var t=[];this.shopList.forEach((function(e,n){t.push({id:n,latitude:e.lat,longitude:e.lon,iconPath:"/static/4spoint.png",width:52,height:54,anchor:{x:.5,y:1}})})),this.markers=t,this.map.includePoints({points:this.markers,padding:[50,50,200,50]})},controltap:function(){},initMap:function(){this.map=t.createMapContext("map")},getLocation:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){var n=new i.default.AMapWX({key:o.Config.mapKey});n.getRegeo({location:t.longitude+","+t.latitude,success:function(n){var o=n[0].regeocodeData.addressComponent.adcode,i={lonlat:[t.longitude,t.latitude],name:n[0].desc,adress:n[0].regeocodeData.formatted_address,province:n[0].regeocodeData.addressComponent.province,cityCode:o};e.currentPosition=i,e.$store.commit("SET_ADDRESS",i),e.center=e.currentPosition.lonlat,e.searchShopParams.city=e.currentPosition.cityCode,e.getShopPiCity()},fail:function(){e.searchShopParams.city="110100",e.getShopPiCity()}})}})},mapcenter:function(){var t=this;this.$store.state.addrInfo.lonlat?this.$nextTick((function(){t.defaultScale=16,t.map.moveToLocation({longitude:t.myPosition.lonlat[0],latitude:t.myPosition.lonlat[1]})})):this.openSet()}},watch:{selectShopInfo:function(t,e){console.log("选择的4s店",t),this.center=[t.lon,t.lat],this.getDistance()},selectCityInfo:function(t,e){t.centralPoint&&(this.center=t.centralPoint.split(","),this.searchShopParams.city=t.code,this.getShopPiCity())},shopList:function(t){}},onLoad:function(){this.getLocation(),this.initMap()}};e.default=c}).call(this,n("543d")["default"])},"2b6d":function(t,e,n){"use strict";n.r(e);var o=n("a053"),i=n("ee25c");for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("5900");var s,c=n("f0c5"),r=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,"31420b89",null,!1,o["a"],s);e["default"]=r.exports},5900:function(t,e,n){"use strict";var o=n("918e"),i=n.n(o);i.a},"918e":function(t,e,n){},a053:function(t,e,n){"use strict";var o,i=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}))},dc3d:function(t,e,n){"use strict";(function(t){n("f318");o(n("66fd"));var e=o(n("2b6d"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},ee25c:function(t,e,n){"use strict";n.r(e);var o=n("281f"),i=n.n(o);for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=i.a}},[["dc3d","common/runtime","common/vendor"]]]);